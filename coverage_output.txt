============================= test session starts =============================
platform win32 -- Python 3.13.7, pytest-7.4.3, pluggy-1.6.0 -- C:\Users\ajaba\AppData\Local\Programs\Python\Python313\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\ajaba\Downloads\master\ftm\piloto ABD\nuevo\web
plugins: cov-4.1.0
collecting ... collected 32 items

tests/unit/core/test_triage_logic.py::test_llamar_modelo_gemini_basic PASSED [  3%]
tests/unit/core/test_triage_logic.py::test_llamar_modelo_gemini_with_vitals PASSED [  6%]
tests/unit/core/test_triage_logic.py::test_llamar_modelo_gemini_contexto_critico PASSED [  9%]
tests/unit/core/test_triage_logic.py::test_llamar_modelo_gemini_exclusion PASSED [ 12%]
tests/unit/repositories/test_roles_repo.py::test_initialize_defaults PASSED [ 15%]
tests/unit/repositories/test_roles_repo.py::test_get_role_by_code PASSED [ 18%]
tests/unit/repositories/test_roles_repo.py::test_create_role_success PASSED [ 21%]
tests/unit/repositories/test_roles_repo.py::test_create_role_duplicate PASSED [ 25%]
tests/unit/repositories/test_users_repo.py::test_create_user PASSED      [ 28%]
tests/unit/repositories/test_users_repo.py::test_get_by_username PASSED  [ 31%]
tests/unit/repositories/test_users_repo.py::test_get_users_by_role PASSED [ 34%]
tests/unit/services/test_notification_service.py::test_create_notification_in_app_only PASSED [ 37%]
tests/unit/services/test_notification_service.py::test_create_notification_with_email PASSED [ 40%]
tests/unit/services/test_notification_service.py::test_send_email_success PASSED [ 43%]
tests/unit/services/test_notification_service.py::test_send_webhook_success PASSED [ 46%]
tests/unit/services/test_patient_service.py::test_validar_dni PASSED     [ 50%]
tests/unit/services/test_patient_service.py::test_generar_codigo_paciente PASSED [ 53%]
tests/unit/services/test_patient_service.py::test_crear_paciente_success PASSED [ 56%]
tests/unit/services/test_patient_service.py::test_crear_paciente_duplicate_ss PASSED [ 59%]
tests/unit/services/test_patient_service.py::test_buscar_paciente_existente PASSED [ 62%]
tests/unit/services/test_permissions_service.py::test_has_permission_no_user PASSED [ 65%]
tests/unit/services/test_permissions_service.py::test_has_permission_superadmin PASSED [ 68%]
tests/unit/services/test_permissions_service.py::test_has_permission_specific_role PASSED [ 71%]
tests/unit/services/test_permissions_service.py::test_get_available_tabs PASSED [ 75%]
tests/unit/services/test_queue_manager.py::test_calculate_priority_score_levels PASSED [ 78%]
tests/unit/services/test_queue_manager.py::test_calculate_priority_score_wait_time PASSED [ 81%]
tests/unit/services/test_queue_manager.py::test_sort_queue PASSED        [ 84%]
tests/unit/services/test_queue_manager.py::test_get_wait_time_alert PASSED [ 87%]
tests/unit/services/test_staff_assignment.py::test_get_current_user_assignment_fixed_only PASSED [ 90%]
tests/unit/services/test_staff_assignment.py::test_get_current_user_assignment_shift_active PASSED [ 93%]
tests/unit/services/test_staff_assignment.py::test_get_current_user_assignment_shift_inactive PASSED [ 96%]
tests/unit/services/test_staff_assignment.py::test_validate_shift_assignment_conflict PASSED [100%]

============================== warnings summary ===============================
..\..\..\..\..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\mongomock\__version__.py:1
  C:\Users\ajaba\AppData\Local\Programs\Python\Python313\Lib\site-packages\mongomock\__version__.py:1: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
    import pkg_resources

..\..\..\..\..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pkg_resources\__init__.py:3146
  C:\Users\ajaba\AppData\Local\Programs\Python\Python313\Lib\site-packages\pkg_resources\__init__.py:3146: DeprecationWarning: Deprecated call to `pkg_resources.declare_namespace('google')`.
  Implementing implicit namespace packages (as specified in PEP 420) is preferred to `pkg_resources.declare_namespace`. See https://setuptools.pypa.io/en/latest/references/keywords.html#keyword-namespace-packages
    declare_namespace(pkg)

src\db\models.py:36
src\db\models.py:36
  C:\Users\ajaba\Downloads\master\ftm\piloto ABD\nuevo\web\src\db\models.py:36: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class PromptVersion(BaseModel):

src\db\models.py:61
src\db\models.py:61
  C:\Users\ajaba\Downloads\master\ftm\piloto ABD\nuevo\web\src\db\models.py:61: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class AIAuditLog(BaseModel):

..\..\..\..\..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_generate_schema.py:942: 26 warnings
  C:\Users\ajaba\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_generate_schema.py:942: PydanticDeprecatedSince20: `__get_validators__` is deprecated and will be removed, use `__get_pydantic_core_schema__` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    warnings.warn(

..\..\..\..\..\..\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_generate_schema.py:319: 50 warnings
  C:\Users\ajaba\AppData\Local\Programs\Python\Python313\Lib\site-packages\pydantic\_internal\_generate_schema.py:319: PydanticDeprecatedSince20: `json_encoders` is deprecated. See https://docs.pydantic.dev/2.12/concepts/serialization/#custom-serializers for alternatives. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    warnings.warn(

src\db\models.py:96
src\db\models.py:96
  C:\Users\ajaba\Downloads\master\ftm\piloto ABD\nuevo\web\src\db\models.py:96: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class Prompt(BaseModel):

src\db\models.py:142
src\db\models.py:142
  C:\Users\ajaba\Downloads\master\ftm\piloto ABD\nuevo\web\src\db\models.py:142: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class VitalSignReference(BaseModel):

src\db\models.py:194
src\db\models.py:194
  C:\Users\ajaba\Downloads\master\ftm\piloto ABD\nuevo\web\src\db\models.py:194: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class TriageRecord(BaseModel):

src\db\models.py:245
src\db\models.py:245
  C:\Users\ajaba\Downloads\master\ftm\piloto ABD\nuevo\web\src\db\models.py:245: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class FileImportRecord(BaseModel):

src\db\models.py:267
src\db\models.py:267
  C:\Users\ajaba\Downloads\master\ftm\piloto ABD\nuevo\web\src\db\models.py:267: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class TranscriptionRecord(BaseModel):

src\db\models.py:293
src\db\models.py:293
  C:\Users\ajaba\Downloads\master\ftm\piloto ABD\nuevo\web\src\db\models.py:293: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class PromptTest(BaseModel):

src\db\models.py:318
src\db\models.py:318
  C:\Users\ajaba\Downloads\master\ftm\piloto ABD\nuevo\web\src\db\models.py:318: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class ConfigItem(BaseModel):

src\db\models.py:353
src\db\models.py:353
  C:\Users\ajaba\Downloads\master\ftm\piloto ABD\nuevo\web\src\db\models.py:353: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class Person(BaseModel):

src\db\models.py:398
src\db\models.py:398
  C:\Users\ajaba\Downloads\master\ftm\piloto ABD\nuevo\web\src\db\models.py:398: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class PatientFlow(BaseModel):

src\db\models.py:433
src\db\models.py:433
  C:\Users\ajaba\Downloads\master\ftm\piloto ABD\nuevo\web\src\db\models.py:433: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class Turno(BaseModel):

src\db\models.py:456
src\db\models.py:456
  C:\Users\ajaba\Downloads\master\ftm\piloto ABD\nuevo\web\src\db\models.py:456: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class ClinicalOption(BaseModel):

src\db\models.py:476
src\db\models.py:476
  C:\Users\ajaba\Downloads\master\ftm\piloto ABD\nuevo\web\src\db\models.py:476: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class Sala(BaseModel):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html

---------- coverage: platform win32, python 3.13.7-final-0 -----------
Name                                          Stmts   Miss  Cover
-----------------------------------------------------------------
src\__init__.py                                   0      0   100%
src\app.py                                      122    122     0%
src\config.py                                    53     26    51%
src\core\__init__.py                              0      0   100%
src\core\data_handler.py                         53     53     0%
src\core\prompt_manager.py                      136    115    15%
src\core\transcription_handler.py                23     23     0%
src\db\__init__.py                                2      0   100%
src\db\connection.py                            103     44    57%
src\db\models.py                                304      5    98%
src\db\repositories\__init__.py                   2      0   100%
src\db\repositories\ai_audit.py                  13      5    62%
src\db\repositories\ai_models.py                 30     30     0%
src\db\repositories\audit.py                     23     23     0%
src\db\repositories\base.py                      62     40    35%
src\db\repositories\centros.py                   47     47     0%
src\db\repositories\clinical_options.py          21     21     0%
src\db\repositories\config.py                    36     15    58%
src\db\repositories\files.py                     24     24     0%
src\db\repositories\funciones.py                 36     36     0%
src\db\repositories\general_config.py            32     32     0%
src\db\repositories\insurers.py                  38     38     0%
src\db\repositories\notification_config.py       82     73    11%
src\db\repositories\people.py                    35     35     0%
src\db\repositories\prompts.py                   76     57    25%
src\db\repositories\report_config.py             10     10     0%
src\db\repositories\roles.py                     40      9    78%
src\db\repositories\salas.py                     40     40     0%
src\db\repositories\tests.py                     33     18    45%
src\db\repositories\transcriptions.py            24     24     0%
src\db\repositories\triage.py                    33     33     0%
src\db\repositories\triage_config.py             23     23     0%
src\db\repositories\turnos.py                    29     13    55%
src\db\repositories\users.py                     40     14    65%
src\db\repositories\vital_signs_repo.py          20     20     0%
src\scripts\__init__.py                           0      0   100%
src\scripts\debug_predictive_error.py            43     43     0%
src\scripts\init_vital_signs_db.py               60     60     0%
src\scripts\inspect_vital_signs.py               17     17     0%
src\scripts\migrate_general_config.py            37     37     0%
src\scripts\migrate_salas.py                     44     44     0%
src\scripts\test_gemini_model.py                 39     39     0%
src\scripts\test_pdf_gen.py                      24     24     0%
src\scripts\update_prompts_model.py              28     28     0%
src\scripts\verify_ai_model_management.py        43     43     0%
src\services\__init__.py                          0      0   100%
src\services\ai_model_discovery.py               42     42     0%
src\services\analytics_service.py                44     44     0%
src\services\contingency_service.py              52     52     0%
src\services\export_service.py                   90     90     0%
src\services\feedback_service.py                 45     45     0%
src\services\flow_manager.py                    107    107     0%
src\services\gemini_client.py                   104     91    12%
src\services\ml_predictive_service.py            84     84     0%
src\services\notification_helpers.py             21     21     0%
src\services\notification_service.py            239    142    41%
src\services\patient_flow_service.py            182    182     0%
src\services\patient_service.py                 143     78    45%
src\services\permissions_service.py              43      8    81%
src\services\predictive_service.py               29     29     0%
src\services\queue_manager.py                    48      9    81%
src\services\report_service.py                  199    199     0%
src\services\room_metrics_service.py             76     76     0%
src\services\room_service.py                     21     21     0%
src\services\room_suggestion_service.py          80     80     0%
src\services\scheduled_reports.py                42     42     0%
src\services\simulated_ia.py                     49     49     0%
src\services\staff_assignment_service.py         96     60    38%
src\services\transcription_service.py            40     40     0%
src\services\triage_service.py                   81     31    62%
src\templates\email_templates.py                 52     34    35%
src\ui\__init__.py                                0      0   100%
src\ui\admission_management_view.py              65     65     0%
src\ui\admission_view.py                        174    174     0%
src\ui\attention_view.py                         88     88     0%
src\ui\audit_panel\__init__.py                    0      0   100%
src\ui\audit_panel\analysis_panel.py             73     73     0%
src\ui\audit_panel\components.py                 89     89     0%
src\ui\audit_panel\debug_panel.py               121    121     0%
src\ui\audit_panel\feedback_list.py              53     53     0%
src\ui\audit_panel\feedback_list_v2.py           42     42     0%
src\ui\audit_panel\main_panel_v2.py              87     87     0%
src\ui\audit_panel\raw_data_panel.py             49     49     0%
src\ui\audit_panel\raw_data_panel_v2.py          21     21     0%
src\ui\audit_panel\tab_audit.py                  56     56     0%
src\ui\audit_panel\tab_audit_v2.py               65     65     0%
src\ui\audit_panel\tab_files.py                   8      8     0%
src\ui\audit_panel\tab_files_v2.py               21     21     0%
src\ui\audit_panel\tab_transcriptions.py          8      8     0%
src\ui\audit_panel\tab_transcriptions_v2.py      21     21     0%
src\ui\boxes_view.py                             67     67     0%
src\ui\config\__init__.py                         2      2     0%
src\ui\config\app_config.py                      70     70     0%
src\ui\config\asignacion_turnos.py               66     66     0%
src\ui\config\centro_tab.py                      46     46     0%
src\ui\config\clinical_options_manager.py        57     57     0%
src\ui\config\config_loader.py                   35     35     0%
src\ui\config\datos_generales.py                 59     59     0%
src\ui\config\equipment_config.py                22     22     0%
src\ui\config\general_tab.py                     45     45     0%
src\ui\config\insurers_manager.py                55     55     0%
src\ui\config\notification_config_ui.py          96     96     0%
src\ui\config\people_manager.py                 138    138     0%
src\ui\config\roles_manager.py                   52     52     0%
src\ui\config\salas_manager.py                   68     68     0%
src\ui\config\staff_conflicts_viewer.py          66     66     0%
src\ui\config\usuarios_manager.py               152    152     0%
src\ui\config\vital_signs_config.py              51     51     0%
src\ui\config_panel.py                           26     26     0%
src\ui\connection_status.py                      16     16     0%
src\ui\loading_indicator.py                      67     67     0%
src\ui\main_view.py                             203    203     0%
src\ui\ml_predictions_panel.py                  144    144     0%
src\ui\multi_center_dashboard.py                171    171     0%
src\ui\room_manager_view.py                     184    184     0%
src\ui\room_metrics_dashboard.py                136    136     0%
src\ui\room_orchestrator.py                      21     21     0%
src\ui\shift_manager.py                         110    110     0%
src\ui\shift_manager_advanced.py                191    191     0%
src\ui\splash_screen.py                          48     48     0%
src\ui\waiting_room_dashboard.py                 25     25     0%
src\utils\__init__.py                             0      0   100%
src\utils\file_handler.py                        86     86     0%
src\utils\file_utils.py                          16     16     0%
src\utils\icon_utils.py                          17     17     0%
src\utils\icons.py                               16     16     0%
src\utils\image_utils.py                         34     34     0%
src\utils\patient_utils.py                       47     47     0%
src\utils\pdf_utils.py                           32     32     0%
src\utils\seed_clinical_options.py               20     20     0%
src\utils\session_utils.py                       23     23     0%
src\utils\setup_indexes.py                       39     39     0%
src\utils\triage_utils.py                        24     24     0%
src\utils\ui_utils.py                             5      5     0%
src\utils\update_triage_prompt.py                19     19     0%
-----------------------------------------------------------------
TOTAL                                          7897   6967    12%

====================== 32 passed, 106 warnings in 7.15s =======================
